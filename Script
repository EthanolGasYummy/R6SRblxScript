local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer
local Drawing = Drawing or getgenv().Drawing

-- üñ•Ô∏è GUI Setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = game.CoreGui
ScreenGui.Enabled = true  -- Default to open when the script starts

-- ESP Toggle Button
local espToggleButton = Instance.new("TextButton")
espToggleButton.Size = UDim2.new(0, 200, 0, 50)
espToggleButton.Position = UDim2.new(0, 10, 0, 10)
espToggleButton.Text = "Toggle ESP"
espToggleButton.Parent = ScreenGui
local espEnabled = true

-- Aimbot Toggle Button
local aimbotToggleButton = Instance.new("TextButton")
aimbotToggleButton.Size = UDim2.new(0, 200, 0, 50)
aimbotToggleButton.Position = UDim2.new(0, 10, 0, 70)
aimbotToggleButton.Text = "Toggle Aimbot"
aimbotToggleButton.Parent = ScreenGui
local aimbotEnabled = true

-- Change ESP Color Button
local colorButton = Instance.new("TextButton")
colorButton.Size = UDim2.new(0, 200, 0, 50)
colorButton.Position = UDim2.new(0, 10, 0, 130)
colorButton.Text = "Change ESP Color"
colorButton.Parent = ScreenGui
local espColor = Color3.fromRGB(255, 0, 0)

-- üîÅ FOV settings
local fovSizes = {80, 150, 250}
local fovIndex = 1
local currentFov = fovSizes[fovIndex]

-- üü† Draw the circle (FOV)
local fovCircle = Drawing.new("Circle")
fovCircle.Color = Color3.fromRGB(255, 255, 0)
fovCircle.Thickness = 2
fovCircle.Transparency = 0.5
fovCircle.Filled = false
fovCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
fovCircle.Radius = currentFov

-- üéØ Draw annotation text
local fovText = Drawing.new("Text")
fovText.Position = Vector2.new(10, Camera.ViewportSize.Y - 40)
fovText.Size = 24
fovText.Center = false
fovText.Outline = true
fovText.Color = Color3.fromRGB(255, 255, 255)
fovText.Text = "FOV: " .. currentFov .. " üéØ"
fovText.Visible = true

-- üîò Toggle FOV size
UserInputService.InputBegan:Connect(function(input)
	if input.KeyCode == Enum.KeyCode.Alt then
		fovIndex = fovIndex % #fovSizes + 1
		currentFov = fovSizes[fovIndex]
		fovCircle.Radius = currentFov
		fovText.Text = "FOV: " .. currentFov .. " üéØ"
	end
end)

-- üü• Chams
local highlights = {}

function createCham(player)
	if player.Character and not highlights[player] then
		local highlight = Instance.new("Highlight")
		highlight.Adornee = player.Character
		highlight.FillColor = espColor
		highlight.OutlineColor = Color3.fromRGB(0, 0, 0)
		highlight.FillTransparency = 0.5
		highlight.OutlineTransparency = 0
		highlight.Parent = game.CoreGui
		highlights[player] = highlight
	end
end

function removeCham(player)
	if highlights[player] then
		highlights[player]:Destroy()
		highlights[player] = nil
	end
end

function refreshChams()
	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and espEnabled then
			if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
				createCham(player)
			else
				removeCham(player)
			end
		else
			removeCham(player)
		end
	end
end

task.spawn(function()
	while true do
		refreshChams()
		task.wait(1)
	end
end)

-- üß† Aimbot logic
local aiming = false

UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if input.UserInputType == Enum.UserInputType.MouseButton2 and aimbotEnabled then
		aiming = true
	end
end)

UserInputService.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton2 then
		aiming = false
	end
end)

function getClosestHead()
	local closestPlayer = nil
	local closestDistance = math.huge

	for _, player in ipairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
			local head = player.Character.Head
			local screenPos, onScreen = Camera:WorldToViewportPoint(head.Position)

			if onScreen then
				local mousePos = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
				local dist = (Vector2.new(screenPos.X, screenPos.Y) - mousePos).Magnitude

				-- Only use the player if they are inside the FOV circle
				if dist < currentFov and dist < closestDistance then
					closestDistance = dist
					closestPlayer = player
				end
			end
		end
	end

	if closestPlayer and closestPlayer.Character then
		return closestPlayer.Character:FindFirstChild("Head")
	end
end

RunService.RenderStepped:Connect(function()
	fovCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

	if aiming then
		local targetHead = getClosestHead()
		if targetHead then
			Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetHead.Position)
		end
	end
end)

-- üñ•Ô∏è GUI BUTTON FUNCTIONS
espToggleButton.MouseButton1Click:Connect(function()
	espEnabled = not espEnabled
	if espEnabled then
		espToggleButton.Text = "Toggle ESP (ON)"
	else
		espToggleButton.Text = "Toggle ESP (OFF)"
	end
end)

aimbotToggleButton.MouseButton1Click:Connect(function()
	aimbotEnabled = not aimbotEnabled
	if aimbotEnabled then
		aimbotToggleButton.Text = "Toggle Aimbot (ON)"
		fovCircle.Visible = true  -- Show FOV circle when Aimbot is turned on
	else
		aimbotToggleButton.Text = "Toggle Aimbot (OFF)"
		fovCircle.Visible = false  -- Hide FOV circle when Aimbot is turned off
	end
end)

colorButton.MouseButton1Click:Connect(function()
	espColor = Color3.fromRGB(math.random(0,255), math.random(0,255), math.random(0,255))
	for _, player in pairs(Players:GetPlayers()) do
		if player ~= LocalPlayer and player.Character then
			if highlights[player] then
				highlights[player].FillColor = espColor
			end
		end
	end
end)

-- üü¢ Open/Close GUI with Insert key
UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if input.KeyCode == Enum.KeyCode.Insert then
		ScreenGui.Enabled = not ScreenGui.Enabled
	end
end)
