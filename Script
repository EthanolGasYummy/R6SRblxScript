local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Camera = workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer
local Drawing = Drawing or getgenv().Drawing

-- üñ•Ô∏è GUI Setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = game.CoreGui
ScreenGui.Enabled = true  -- Default to open when the script starts
ScreenGui.ResetOnSpawn = false

-- GUI Container
local guiFrame = Instance.new("Frame")
guiFrame.Size = UDim2.new(0, 250, 0, 300)
guiFrame.Position = UDim2.new(0.5, -125, 0.5, -150)
guiFrame.BackgroundTransparency = 0.6  -- 40% visibility
guiFrame.BackgroundColor3 = Color3.fromRGB(30, 60, 120)  -- Blue theme
guiFrame.BorderSizePixel = 0
guiFrame.Parent = ScreenGui

-- Rounded Corners
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = guiFrame

-- üü© ESP Button
local espToggleButton = Instance.new("TextButton")
espToggleButton.Size = UDim2.new(0, 200, 0, 50)
espToggleButton.Position = UDim2.new(0, 10, 0, 60)
espToggleButton.Text = "Toggle ESP"
espToggleButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
espToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
espToggleButton.Parent = guiFrame

-- üüß Aimbot Button
local aimbotToggleButton = Instance.new("TextButton")
aimbotToggleButton.Size = UDim2.new(0, 200, 0, 50)
aimbotToggleButton.Position = UDim2.new(0, 10, 0, 120)
aimbotToggleButton.Text = "Toggle Aimbot"
aimbotToggleButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
aimbotToggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
aimbotToggleButton.Parent = guiFrame

-- üü® FOV Size Button
local fovButton = Instance.new("TextButton")
fovButton.Size = UDim2.new(0, 200, 0, 50)
fovButton.Position = UDim2.new(0, 10, 0, 180)
fovButton.Text = "Change FOV"
fovButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
fovButton.TextColor3 = Color3.fromRGB(255, 255, 255)
fovButton.Parent = guiFrame

-- üü© Rounded Button Corners
local function addUICornerToButton(button)
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 12)
    UICorner.Parent = button
end

addUICornerToButton(espToggleButton)
addUICornerToButton(aimbotToggleButton)
addUICornerToButton(fovButton)

-- üü¶ GUI Dragging Logic
local dragging, dragInput, dragStart, startPos

local function update(input)
    local delta = input.Position - dragStart
    guiFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

guiFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = guiFrame.Position
        input.Changed:Connect(function()
            if not input.UserInputState == Enum.UserInputState.Change then
                dragging = false
            end
        end)
    end
end)

guiFrame.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        update(input)
    end
end)

-- üü© ESP and Aimbot toggled states
local espEnabled = false
local aimbotEnabled = false

-- üü† Toggle FOV size
local fovSizes = {80, 150, 250}
local fovIndex = 1
local currentFov = fovSizes[fovIndex]

-- üü© Draw the circle (FOV)
local fovCircle = Drawing.new("Circle")
fovCircle.Color = Color3.fromRGB(255, 255, 0)
fovCircle.Thickness = 2
fovCircle.Transparency = 0.5
fovCircle.Filled = false
fovCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
fovCircle.Radius = currentFov

-- üéØ Draw annotation text
local fovText = Drawing.new("Text")
fovText.Position = Vector2.new(10, Camera.ViewportSize.Y - 40)
fovText.Size = 24
fovText.Center = false
fovText.Outline = true
fovText.Color = Color3.fromRGB(255, 255, 255)
fovText.Text = "FOV: " .. currentFov .. " üéØ"
fovText.Visible = true

-- üîò Toggle FOV size
fovButton.MouseButton1Click:Connect(function()
    fovIndex = fovIndex % #fovSizes + 1
    currentFov = fovSizes[fovIndex]
    fovCircle.Radius = currentFov
    fovText.Text = "FOV: " .. currentFov .. " üéØ"
end)

-- üß† Aimbot logic
local aiming = false

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if input.UserInputType == Enum.UserInputType.MouseButton2 and aimbotEnabled then
        aiming = true
    end
end)

UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        aiming = false
    end
end)

function getClosestHead()
    local closestPlayer = nil
    local closestDistance = math.huge

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
            local head = player.Character.Head
            local screenPos, onScreen = Camera:WorldToViewportPoint(head.Position)

            if onScreen then
                local mousePos = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
                local dist = (Vector2.new(screenPos.X, screenPos.Y) - mousePos).Magnitude

                -- Only use the player if they are inside the FOV circle
                if dist < currentFov and dist < closestDistance then
                    closestDistance = dist
                    closestPlayer = player
                end
            end
        end
    end

    if closestPlayer and closestPlayer.Character then
        return closestPlayer.Character:FindFirstChild("Head")
    end
end

RunService.RenderStepped:Connect(function()
    fovCircle.Position = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)

    if aiming then
        local targetHead = getClosestHead()
        if targetHead then
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, targetHead.Position)
        end
    end
end)

-- üü© Toggle ESP button
espToggleButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    if espEnabled then
        espToggleButton.Text = "Toggle ESP (ON)"
    else
        espToggleButton.Text = "Toggle ESP (OFF)"
    end
end)

-- üü† Toggle Aimbot button
aimbotToggleButton.MouseButton1Click:Connect(function()
    aimbotEnabled = not aimbotEnabled
    if aimbotEnabled then
        aimbotToggleButton.Text = "Toggle Aimbot (ON)"
        fovCircle.Visible = true  -- Show FOV circle when Aimbot is turned on
    else
        aimbotToggleButton.Text = "Toggle Aimbot (OFF)"
        fovCircle.Visible = false  -- Hide FOV circle when Aimbot is turned off
    end
end)

-- üü© Toggle the visibility of the GUI with Insert key
local guiVisible = true

UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.Insert then
        guiVisible = not guiVisible
        ScreenGui.Enabled = guiVisible
    end
end)
